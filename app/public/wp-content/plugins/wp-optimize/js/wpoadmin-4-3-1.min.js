jQuery(function(t){WP_Optimize=WP_Optimize(),"undefined"!=typeof WP_Optimize_Cache&&(WP_Optimize_Cache=WP_Optimize_Cache()),"undefined"!=typeof wp_optimize.minify&&(WP_Optimize_Minify=wp_optimize.minify.init())}),function(t){var e=[];t.fn.form_errors=function(){return this},t.fn.form_errors.add=function(t,i){!1===this.has_error(t)&&e.push({type:t,message:i})},t.fn.form_errors.remove=function(t){var i=this.has_error(t);i!==!1&&e.splice(i,1)},t.fn.form_errors.has_error=function(i){var o=!1;return t.each(e,function(t,e){console.log(t,e),i==e.type&&(o=t)}.bind(this)),o},t.fn.form_errors.has_errors=function(){return e.length>0}}(jQuery);var WP_Optimize=function(){function t(){if(Q("#enable-schedule").length){var t=Q("#enable-schedule").is(":checked");t?Q("#wp-optimize-auto-options").css("opacity","1"):Q("#wp-optimize-auto-options").css("opacity","0.5")}}function e(t,e,i){e="undefined"==typeof e?"#wp-optimize-wrap":e,i="undefined"==typeof i?15:i,Q(t).hide().prependTo(e).slideDown("fast").delay(1e3*i).slideUp("fast",function(){Q(this).remove()})}function i(t,i){var o={type:t,enable:i?1:0};Q("#"+t+"_spinner").show(),M("enable_or_disable_feature",o,function(i){if(Q("#"+t+"_spinner").hide(),i&&i.hasOwnProperty("output"))for(var o=0,n=i.output.length;o<n;o++){var a='<div class="updated"><p>'+i.output[o]+"</p></div>";e(a,"#"+t+"_notice")}i&&i.hasOwnProperty("messages")&&Q("#"+t+"_actionmsg").html(i.messages.join(" - "))})}function o(t){t?Q("#wp-optimize-wrap").addClass("wpo-mobile-menu-opened"):Q("#wp-optimize-wrap").removeClass("wpo-mobile-menu-opened")}function n(){if(!G&&!V){var t=Q(".wpo-page[data-whichpage=WP-Optimize]"),e=t.find(".wpo_shade");e.removeClass("hidden"),G=!0,M("get_database_tabs",{},function(e){V=!0,e.hasOwnProperty("optimizations")&&t.find(".wp-optimize-optimizations-table-placeholder").replaceWith(e.optimizations),z(e),Q(document).trigger("wpo_database_tabs_loaded")}).always(function(){G=!1,e.addClass("hidden")})}}function a(t){var e="",t="undefined"==typeof t?"string":t,i=Q("#wp-optimize-database-settings form input[name!='action'], #wp-optimize-database-settings form select, #wp-optimize-database-settings form textarea, #wp-optimize-general-settings form input[name!='action'], #wp-optimize-general-settings form textarea, #wp-optimize-general-settings form select, #wp-optimize-nav-tab-contents-optimize input[type='checkbox'], .wp-optimize-nav-tab-contents input[name^='enable-auto-backup-'], #wpo-404-detector-form input[type=checkbox]");return"object"==t?e=i.serializeJSON({useIntKeysAsArrayIndex:!0}):(e=i.serialize(),Q.each(Q('#wp-optimize-database-settings form input[type=checkbox], #wp-optimize-general-settings form input[type=checkbox], .wp-optimize-nav-tab-contents input[name^="enable-auto-backup-"], #wpo-404-detector-form input[type=checkbox]').filter(function(t){return 0==Q(this).prop("checked")}),function(t,i){var o="0";e+="&"+Q(i).attr("name")+"="+o})),e}function s(){M("optimizations_done",{},function(){}),Y=!1}function r(){if(!$.get_lock())return void(R>0&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting"));R>0&&console.log("WP-Optimize: process_queue(): got queue lock");var t=$.peek(),e=0,i=Q("#wpo_all_sites"),o=i.data("active_site");if("object"==typeof t){if(data=t,t=t.optimization_id,e=data.blog_id,"undefined"==typeof o)i.data("active_site",e),p(e,0);else if(o!=e){var n=o;i.data("active_site",e),p(e,n)}}else data={};if("undefined"==typeof t){R>0&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),$.unlock();var n=i.data("active_site");return p(0,n),void s()}if(R>0&&console.log("WP-Optimize: process_queue(): processing item: "+t),$.dequeue(),Q(document).trigger(["do_optimization_",t,"_start"].join("")),"optimizetables"===t){Q("#optimization_info_"+t).html(wpoptimize.optimizing_table+" "+data.optimization_table);var a=parseInt(wpoptimize.table_optimization_timeout)?parseInt(wpoptimize.table_optimization_timeout):12e4,l={timeout:a,error:function(e,o){if(Y=!0,"timeout"===o?console.warn("The request to optimize the table "+data.optimization_table+" timed out after "+a/1e3+" seconds"):console.warn('There was an error when running the optimization "'+t+'".',o,e,data),$.is_empty()){var n=i.data("active_site");p(n,0),Q("#optimization_spinner_"+t).hide(),Q("#optimization_checkbox_"+t).show(),Q(".optimization_button_"+t).prop("disabled",!1),Q("#optimization_info_"+t).html(wpoptimize.optimization_complete+" "+wpoptimize.with_warnings)}setTimeout(function(){$.unlock(),r()},500)}}}else var l={};M("do_optimization",{optimization_id:t,data:data},function(e){if(Q("#optimization_spinner_"+t).hide(),Q("#optimization_checkbox_"+t).show(),Q(".optimization_button_"+t).prop("disabled",!1),Q(document).trigger(["do_optimization_",t,"_done"].join(""),e),e){for(var i="",o=0,n=e.errors.length;o<n;o++)i+='<span class="error">'+e.errors[o]+"</span><br>";for(var o=0,n=e.messages.length;o<n;o++)i+=e.errors[o]+"<br>";for(var o=0,n=e.result.output.length;o<n;o++)i+=e.result.output[o]+"<br>";if(Q("#optimization_info_"+t).html(i),e.hasOwnProperty("status_box_contents")&&Q("#wp_optimize_status_box").css("opacity","1").find(".inside").html(e.status_box_contents),e.hasOwnProperty("table_list")&&Q("#wpoptimize_table_list tbody").html(Q(e.table_list).find("tbody").html()),e.hasOwnProperty("total_size")&&Q("#optimize_current_db_size").html(e.total_size),"optimizetables"===t){const a="optimizetables";$.contains_id(a)?(Q("#optimization_checkbox_optimizetables").hide(),Q("#optimization_spinner_optimizetables").show(),Q(".optimization_button_optimizetables").prop("disabled",!0)):(Q("#optimization_checkbox_optimizetables").show(),Q("#optimization_spinner_optimizetables").hide(),Q(".optimization_button_optimizetables").prop("disabled",!1),Q("#optimization_info_optimizetables").html(wpoptimize.optimization_complete+(Y?" "+wpoptimize.with_warnings:"")))}if(e.result.meta&&e.result.meta.hasOwnProperty("awaiting_mod")){var s=e.result.meta.awaiting_mod;s>0?Q("#adminmenu .awaiting-mod .pending-count").remove(s):Q("#adminmenu .awaiting-mod").remove()}}setTimeout(function(){$.unlock(),r()},500)},!0,l)}function p(t,e){0!=e&&(Q("#site-"+e).show(),Q("#optimization_spinner_site-"+e).hide()),Q("#site-"+t).hide(),Q("#optimization_spinner_site-"+t).show()}function l(t){var e=Q("#wp-optimize-nav-tab-contents-optimize .wp-optimize-settings-"+t);e||console.log("do_optimization: row corresponding to this optimization ("+t+") not found");var i={},o=0;if(Q('input[type="checkbox"]',Q("#optimization_info_"+t)).each(function(){var t=Q(this);t.is(":checked")&&(i[t.attr("name")]=t.val(),o++)}),1!=Q(".optimization_button_"+t).prop("disabled")){var n=!1;if("optimizetables"==t){var a=Q("#wpoptimize_table_list #the-list tr"),s=Q("#wpo_sitelist_moreoptions").length>0&&Q("#wpo_sitelist_moreoptions").is(":visible"),p=[];s&&(p=Q('#wpo_sitelist_moreoptions input[type="checkbox"]:checked').map(function(){return parseInt(Q(this).val())}).get()),n=!0,Q(a).each(function(e){var i=(Q(this).find("td"),Q(this).data("type")),o=Q(this).data("tablename"),a=Q(this).data("optimizable"),r=Q(this).data("blog_id")?parseInt(Q(this).data("blog_id")):1,l=!0;if(s&&-1==p.indexOf(r)&&(l=!1),""!=o&&l&&(1==parseInt(a)||L)){var c={optimization_id:t,blog_id:r,optimization_table:o,optimization_table_type:i,optimization_force:L};$.enqueue(c),n=!1}})}else{if(data={optimization_id:t},o>0)for(var l in i)i.hasOwnProperty(l)&&(data[l]=i[l]);$.enqueue(data)}n||(Q("#optimization_checkbox_"+t).hide(),Q("#optimization_spinner_"+t).show(),Q(".optimization_button_"+t).prop("disabled",!0),Q("#optimization_info_"+t).html("..."),r())}}function c(t){Q("#wpo_settings_sites_list").length?M("save_site_settings",{"wpo-sites":_()},function(){t&&t()}):t&&t()}function _(){var t=[];return Q('#wpo_settings_sites_list input[type="checkbox"]').each(function(){var e=Q(this);e.is(":checked")&&t.push(e.attr("value"))}),t}function d(t){var e=Q("#optimizations_list .optimization_checkbox:checked"),i=[];e.filter(function(t,e){var i=e.id.replace("optimization_checkbox_",""),o=Q("#tmpl-wpo-"+i);return 0<o.length}).each(function(t,e){var o=e.id.replace("optimization_checkbox_","");N(o)&&i.push(o)}),m(i,t)}function m(t,e){if(0<t.length){var i=[];t.forEach(function(t){var e=Q(Q("#tmpl-wpo-"+t).html()).children("p").html();i.push(e)}),wp_optimize.modal.open(Object.assign(U("grouped-warnings"),{cancel:function(){},confirm:function(){this.close(),e()},content:function(){return X.replace("[[warning_messages]]","<ul><li>"+i.join("</li><li>")+"</li></ul>")}}))}else e()}function u(){var t=!1;Q("#enable-auto-backup").is(":checked")&&(t=!0),f(),1==t?g(v):v()}function g(t,e){"undefined"==typeof e&&(e="");var i=e?0:1;"function"==typeof updraft_backupnow_inpage_go?updraft_backupnow_inpage_go(function(){Q("#updraft-backupnow-inpage-modal").dialog("close"),t&&t()},e,"autobackup",0,i,0,wpoptimize.automatic_backup_before_optimizations):t&&t()}function f(){var t=a("object");t.auto_backup=Q("#enable-auto-backup").is(":checked"),M("save_auto_backup_option",t)}function w(t,e,i,o){t.on("click",function(){return e.hasClass("wpo_always_visible")||e.toggleClass("wpo_hidden"),!1}),h(i,o)}function h(t,e){t.on("change",function(){t.is(":checked")?e.prop("checked",!0):e.prop("checked",!1),b(t,e)}),e.on("change",function(){b(t,e)}),b(t,e)}function b(t,e){var i=0,o=0;if(e.each(function(){Q(this).is(":checked")&&o++,i++}),t.next().is("label")&&t.next().data("label")){var n=t.next(),a=n.data("label");i==o?n.text(a):n.text(a.replace("all",[o," of ",i].join("")))}i==o?t.prop("checked",!0):t.prop("checked",!1)}function v(){var t=Q("#optimizations_list .optimization_checkbox:checked").toArray(),e=t.sort(function(t,e){var i=Q(t).closest(".wp-optimize-settings").data("optimization_run_sort_order"),o=Q(e).closest(".wp-optimize-settings").data("optimization_run_sort_order");return i-o}),i={};e.forEach(function(t){var e=Q(t).closest(".wp-optimize-settings").data("optimization_id");return e?(i[e]={active:1},void l(e)):void console.log("Optimization ID corresponding to pressed button not found")}),M("save_manual_run_optimization_options",i)}function z(t){if(t.hasOwnProperty("table_list")){var e=!0,i=function(t){Q("#wpoptimize_table_list tbody").css("opacity","1")};Q("#wpoptimize_table_list tbody").remove(),Q("#wpoptimize_table_list tfoot").remove(),Q("#wpoptimize_table_list thead").after(t.table_list),Q("#wpoptimize_table_list").trigger("updateAll",[e,i])}t.hasOwnProperty("total_size")&&Q("#optimize_current_db_size").html(t.total_size),t.hasOwnProperty("show_innodb_force_optimize")&&Q(".innodb_force_optimize--container").toggleClass("hidden",!t.show_innodb_force_optimize),W(),x(H)}function y(t){var e=t.next(),i=e.next(),o=t.data("table"),n=t.data("type"),a={optimization_id:"optimizetables",optimization_table:o,optimization_table_type:n};t.hide(),H&&(a.optimization_force=!0),e.removeClass("visibility-hidden"),M("do_optimization",{optimization_id:"optimizetables",data:a},function(o){if(o.result.meta.error)t.closest("tr").html('<td colspan="8" class="no-table"><p>'+o.result.meta.message+"</p></td>"),setTimeout(function(){Q("#wp_optimize_table_list_refresh").trigger("click")},2e3);else if(o.result.meta.tableinfo){var n=t.closest("tr"),a=o.result.meta,s=a.tableinfo;k(n,s),Q("#wpoptimize_table_list > tbody:last th:eq(6)").html(['<span style="color:',a.overhead>0?"#0000FF":"#004600",'">',a.overhead_formatted,"</span>"].join(""))}t.prop("disabled",!1),e.addClass("visibility-hidden"),i.show().removeClass("visibility-hidden").delay(2500).fadeOut("fast",function(){t.show(),i.show().addClass("visibility-hidden")})})}function k(t,e){Q("td:eq(2)",t).text(e.rows),Q("td:eq(3)",t).text(e.data_size),Q("td:eq(4)",t).text(e.index_size),Q("td:eq(5)",t).text(e.type),e.is_optimizable?Q("td:eq(6)",t).html(['<span style="color:',e.overhead>0?"#0000FF":"#004600",'">',e.overhead,"</span>"].join("")):Q("td:eq(6)",t).html('<span color="#0000FF">-</span>')}function x(t){Q(".run-single-table-optimization").each(function(){var e=Q(this);e.data("disabled")&&(t?e.prop("disabled",!1):e.prop("disabled",!0))})}function O(t){var e,i,o;if(t)for(e in t)t.hasOwnProperty(e)&&(i=["#wp-optimize-settings-",t[e].dom_id].join(""),o=t[e].info?t[e].info:"",Q(i+" .wp-optimize-settings-optimization-info").html(o))}function C(){var t=["",_().join("_")].join("");dt.hasOwnProperty(t)?O(dt[t]):M("get_optimizations_info",{"wpo-sites":_()},function(e){e&&(dt[t]=e,O(e))})}function j(t){var e=Q("#wpo_import_spinner"),i=Q("#wpo_import_success_message"),o=Q("#wpo_import_error_message");e.show(),M("import_settings",{settings:t},function(t){e.hide(),t&&t.errors&&t.errors.length?(o.text(t.errors.join("<br>")),o.slideDown()):t&&t.messages&&t.messages.length&&(i.text(t.messages.join("<br>")),i.slideDown(),setTimeout(function(){window.location.reload()},500)),Q("#wpo_import_settings_btn").prop("disabled",!1)})}function P(t,e){var i=document.body.appendChild(document.createElement("a")),o=new Date,n=o.getFullYear(),a=o.getMonth()<10?["0",o.getMonth()].join(""):o.getMonth(),s=o.getDay()<10?["0",o.getDay()].join(""):o.getDay();e=e?e:["wpo-settings-",n,"-",a,"-",s,".json"].join(""),i.setAttribute("download",e),i.setAttribute("style","display:none;"),i.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(JSON.stringify(t))),i.click()}function T(t){var e=t.next(),i=e.next(),o=t.data("table"),n={optimization_id:"orphanedtables",optimization_table:o,optimization_action:"toinnodb"};e.removeClass("visibility-hidden"),M("do_optimization",{optimization_id:"orphanedtables",data:n},function(e){if(e.result.meta.error)return t.closest("tr").html('<td colspan="8" class="no-table"><p>'+e.result.meta.message+"</p></td>"),void setTimeout(function(){Q("#wp_optimize_table_list_refresh").trigger("click")},2e3);if(e.result.meta.success){var n=t.closest("tr");i.show().removeClass("visibility-hidden"),n.find(".toinnodb").remove(),setTimeout(function(){i.fadeOut("slow",function(){n.find("[data-colname='Type']").text("InnoDB")})},500)}else{var a=wpoptimize.table_was_not_converted.replace("%s",o);e.result.meta.message&&(a+="("+e.result.meta.message+")"),alert(a)}}).always(function(){t.prop("disabled",!1),e.addClass("visibility-hidden")})}function D(){var t=ut.next(),e=t.next(),i=ut.data("table"),o={optimization_id:"orphanedtables",optimization_table:i};t.removeClass("visibility-hidden"),M("do_optimization",{optimization_id:"orphanedtables",data:o},function(t){if(t.result.meta.success){var o=ut.closest("tr");e.show().removeClass("visibility-hidden"),setTimeout(function(){o.fadeOut("slow",function(){o.remove(),W()})},500)}else{var n=wpoptimize.table_was_not_deleted.replace("%s",i);t.result.meta.message&&(n+="("+t.result.meta.message+")"),alert(n)}}).always(function(){ut.prop("disabled",!1),t.addClass("visibility-hidden")})}function W(){var t=Q("#wpoptimize_table_list"),e=!0;Q("tr",t).each(function(){var t=Q(this);if(Q("button",t).length>0)return e=!1,!1}),Q("tr",t).each(function(){var t=Q(this);e?Q("td:last, th:last",t).hide():Q("td:last, th:last",t).show()})}function q(t,e){var i=t.val(),o=t.data("validate");if(!o&&e)return""!=i.trim();if(o&&!e&&""==i.trim())return!0;var n=!0;switch(o){case"email":for(var a=/\S+@\S+\.\S+/,s=i.split(","),r="",p=0;p<s.length;p++)r=s[p].trim(),""!=r&&a.test(r)||(n=!1);break;case"url":var a=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i;n=a.test(i)}return n}function I(){var t=new Date;return{epoch_date:t.getTime(),local_date:t.toLocaleString(),network_site_url:wpoptimize.network_site_url,data:{cache_settings:wp_optimize.cache_settings(),minify_settings:wp_optimize.minify_settings(),smush_settings:wp_optimize.smush_settings(),database_settings:a("string")}}}function A(t){t.preventDefault(),form_data=JSON.stringify(I());var e=document.body.appendChild(document.createElement("a"));e.setAttribute("download",wpoptimize.export_settings_file_name),e.setAttribute("style","display:none;"),e.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(form_data)),e.click()}function S(t){var e=new FileReader;e.onload=function(){j(this.result)},e.readAsText(t)}function j(t){var e;try{e=wpo_parse_json(t)}catch(i){return Q.unblockUI(),jQuery("#import_settings").val(""),console.log(t),console.log(i),void alert(wpoptimize.import_invalid_json_file)}if(window.confirm(wpoptimize.importing_data_from+" "+e.network_site_url+"\n"+wpoptimize.exported_on+" "+e.local_date+"\n"+wpoptimize.continue_import)){var o=JSON.stringify(e.data);M("import_settings",{settings:o},function(t){Q.unblockUI(),t&&t.errors?alert(t.errors.join("<br />")):t&&t.success&&(alert(t.message),setTimeout(function(){window.location.reload()},200))})}else Q.unblockUI()}function U(t){var e=destructive_actions_confirm_popup={postmeta:{className:"wpo-confirm",events:{"click .wpo-modal--bg":"close","click #confirm_post_meta_deletion":"deleteConfirm","click .cancel":"cancel","click #confirm-post-meta-delete-action":"confirm"},content:function(){var t=wp.template("wpo-postmeta");return t({})},deleteConfirm:function(){var t=Q("#confirm_post_meta_deletion").is(":checked");Q(".delete-post-meta").prop("disabled",!t)}},orphandata:{className:"wpo-confirm",events:{"click .wpo-modal--bg":"close","click #confirm_orphaned_relationship_data_deletion":"deleteConfirm","click .cancel":"cancel","click #confirm-orphaned-relationship-data-delete-action":"confirm"},content:function(){var t=wp.template("wpo-orphandata");return t({})},deleteConfirm:function(){var t=Q("#confirm_orphaned_relationship_data_deletion").is(":checked");Q(".delete-orphaned-relationship-data").prop("disabled",!t)}},"grouped-warnings":{className:"wpo-confirm",events:{"click .wpo-modal--bg":"close","click #confirm_grouped_warnings_data_deletion":"deleteConfirm","click .cancel":"cancel","click #confirm-grouped-warnings-data-delete-action":"confirm"},deleteConfirm:function(){var t=Q("#confirm_grouped_warnings_data_deletion").is(":checked");Q(".delete-grouped-warnings-data").prop("disabled",!t)}}};return e[t]}function E(){Q("#optimization_button_postmeta_big").on("click",function(t){return function(e){var i=Q("#optimization_checkbox_postmeta");return N("postmeta")?(wp_optimize.modal.open(Object.assign(U("postmeta"),{cancel:function(){Q(i).prop("checked",!1)},confirm:function(){F(),this.close(),Q(e).prop("bypass-confirm-box",!0),Q(e).trigger("click")}})),t.preventDefault(),!1):(Q(e).prop("bypass-confirm-box",!1),!0)}(this)})}function F(){var t=Q("#ignores_orphaned_relationship_data_deletion_warning");t.is(":visible")&&t.is(":checked")&&M("user_ignores_orphaned_relationship_data_deletion_warning",{},function(t){t.success&&(wpoptimize.user_always_ignores_orphaned_relationship_data_deletion_warning="1")});var e=Q("#ignores_post_meta_deletion_warning");e.is(":visible")&&e.is(":checked")&&M("user_ignores_post_meta_deletion_warning",{},function(t){t.success&&(wpoptimize.user_always_ignores_post_meta_deletion_warning="1")})}function N(t){if("orphandata"==t){var e=1==Q("#optimization_button_orphandata_big").prop("bypass-confirm-box");return!e&&(""==wpoptimize.user_always_ignores_orphaned_relationship_data_deletion_warning||"1"!==wpoptimize.user_always_ignores_orphaned_relationship_data_deletion_warning)}if("postmeta"==t){var e=1==Q("#optimization_button_postmeta_big").prop("bypass-confirm-box");return!e&&(""==wpoptimize.user_always_ignores_post_meta_deletion_warning||"1"!==wpoptimize.user_always_ignores_post_meta_deletion_warning)}}function B(){Q("#optimization_button_orphandata_big").on("click",function(t){return function(e){var i=Q("#optimization_checkbox_orphandata");return N("orphandata")?(wp_optimize.modal.open(Object.assign(U("orphandata"),{cancel:function(){Q(i).prop("checked",!1)},confirm:function(){F(),this.close(),Q(e).prop("bypass-confirm-box",!0),Q(e).trigger("click")}})),t.preventDefault(),!1):(Q(e).prop("bypass-confirm-box",!1),!0)}(this)})}var Q=jQuery,R=0,$=new Updraft_Queue,J=wp_optimize.block_ui,M=wp_optimize.send_command,L=!1,Y=!1,H=!1,K=WP_Optimize_Heartbeat();h(Q("#select_all_optimizations"),Q("#optimizations_list .optimization_checkbox")),t(),Q("#enable-schedule").on("change",function(){t()}),Q(document).on("wpo_database_tabs_loaded",function(){var t=document.getElementById("wpoptimize_table_list");if(null!==t){enhanceSortableAccessibility([t]),document.getElementById("wpoptimize_table_list_filter").addEventListener("input",function(){for(var e=this.value.toLowerCase(),i=new RegExp(e,"i"),o=t.querySelector("tbody"),n=t.querySelector("tfoot"),a=o.getElementsByTagName("tr"),s=0,r=0;r<a.length;r++){var p=a[r].getElementsByTagName("td")[1];if(p){var l=p.getAttribute("data-tablename");i.test(l)?a[r].style.display="":(a[r].style.display="none",s++)}}n.style.display=s>0?"none":"";var c=document.getElementById("wpoptimize_table_list_tables_not_found");s===a.length?c.style.display="block":c.style.display="none"});var e=Q("#innodb_force_optimize"),i=e.closest("tr"),o=Q("#innodb_force_optimize_single");e.on("change",function(){Q('button, input[type="checkbox"]',i).each(function(){L=e.is(":checked");var t=Q(this);t.data("disabled")&&(L?t.prop("disabled",!1):t.prop("disabled",!0))})}),o.on("change",function(){H=Q(this).is(":checked"),x(H)}),H=o.is(":checked"),L=e.is(":checked"),x(H),E(),B()}}),Q("#wp-optimize-disable-enable-trackbacks-enable").on("click",function(){i("trackbacks",!0)}),Q("#wp-optimize-disable-enable-trackbacks-disable").on("click",function(){i("trackbacks",!1)}),Q("#wp-optimize-disable-enable-comments-enable").on("click",function(){i("comments",!0)}),Q("#wp-optimize-disable-enable-comments-disable").on("click",function(){i("comments",!1)}),Q(".wpo-pages-menu").on("click","a",function(t){t.preventDefault(),Q(this).is(".active")||(Q(".wpo-pages-menu a.active").removeClass("active"),Q(".wpo-page.active").removeClass("active"),Q(this).addClass("active"),Q('.wpo-page[data-whichpage="'+Q(this).data("menuslug")+'"]').addClass("active"),window.scroll(0,0),Q("#wp-optimize-wrap").trigger("page-change",{page:Q(this).data("menuslug")})),Q("#wp-optimize-nav-page-menu").trigger("click")}),Q("#wp-optimize-wrap").on("page-change",function(t,e){var i=Q(".wpo-page[data-whichpage="+e.page+"]").find(".nav-tab-wrapper .nav-tab-active");Q("#wp-optimize-wrap").trigger("tab-change",{page:e.page,tab:i.data("tab")}),Q("#wp-optimize-wrap").trigger("tab-change/"+e.page+"/"+i.data("tab"),{content:Q("#"+i.attr("id")+"-contents")})}),setTimeout(function(){Q("#wp-optimize-wrap").trigger("page-change",{page:Q(".wpo-pages-menu a.active").data("menuslug")})},500),Q(".nav-tab-wrapper .nav-tab").on("click",function(t){t.preventDefault();var e=Q(this).attr("id"),i=Q(this).closest(".nav-tab-wrapper");if(e){if(o(!1),Q(this).is('[id^="wp-optimize-nav-tab-menu-"]'))return void o(!0);i.find(".nav-tab:not(#wp-optimize-nav-tab-"+e+")").removeClass("nav-tab-active"),Q(this).addClass("nav-tab-active"),Q(this).closest(".wpo-page").find(".wp-optimize-nav-tab-contents").hide(),Q("#"+e+"-contents").show(),Q("#wp-optimize-wrap").trigger("tab-change",{page:Q(this).data("page"),tab:Q(this).data("tab")}),Q("#wp-optimize-wrap").trigger("tab-change/"+Q(this).data("page")+"/"+Q(this).data("tab"),{content:Q("#"+e+"-contents")})}}),Q("#wp-optimize-nav-page-menu").on("click",function(t){t.preventDefault(),Q(this).toggleClass("opened")}),Q("#wp-optimize-wrap").on("click",".js--wpo-goto",function(t){t.preventDefault();var e=Q(this).data("page"),i=Q(this).data("tab");e&&Q('.wpo-pages-menu a[data-menuslug="'+e+'"]').trigger("click"),i&&Q('.wpo-page.active .nav-tab-wrapper a[data-tab="'+i+'"]').trigger("click")});var G=!1,V=!1;Q("#wp-optimize-wrap").on("tab-change/WP-Optimize/tables",function(t){n()}),Q("#wp-optimize-wrap").on("tab-change/WP-Optimize/optimize",function(t,e){n()}),Q("#wp-optimize-wrap").on("tab-change/wpo_settings/settings",function(t,e){e.content.find(".innodb_force_optimize--container").length&&n(),WPO_Status_Report()}),Q("#wp-optimize-nav-tab-WP-Optimize-optimize-contents").on("click","button.wp-optimize-settings-optimization-run-button",function(){var t=Q(this).closest(".wp-optimize-settings").data("optimization_id");return t?void(1!=Q(".optimization_button_"+t).prop("disabled")&&(Q(".optimization_button_"+t).prop("disabled",!0),c(function(){Q(".optimization_button_"+t).prop("disabled",!1),l(t)}))):void console.log("Optimization ID corresponding to pressed button not found")}),Q("#wp-optimize-nav-tab-WP-Optimize-optimize-contents #wp-optimize").on("click",function(t){t.preventDefault(),null==X&&(X=Q("#tmpl-wpo-grouped-warnings").html().toString()),d(function(){return function(t){Q(t).prop("disabled",!0),c(function(){Q(t).prop("disabled",!1),u()})}}(this))});var X=null,Z=Q("#wpo_settings_sites_list"),tt=Z.find("ul").first(),et=Q('input[type="checkbox"]',tt),it=Z.find("#wpo_all_sites"),ot=Q("#wpo_sitelist_show_moreoptions"),nt=Q("#wpo_sitelist_moreoptions"),at=Q("#wpo_settings_sites_list_cron"),st=at.find("ul").first(),rt=Q('input[type="checkbox"]',st),pt=at.find("#wpo_all_sites_cron"),lt=Q("#wpo_sitelist_show_moreoptions_cron"),ct=Q("#wpo_sitelist_moreoptions_cron");w(ot,nt,it,et);var _t;Q([it,et]).each(function(){Q(this).on("change",function(){clearTimeout(_t),_t=setTimeout(function(){C()},1e3)})}),w(lt,ct,pt,rt),Q("#wp_optimize_table_list_refresh").on("click",function(t){t.preventDefault();var e=Q(this).closest(".wpo-tab-postbox").find(".wpo_shade");e.removeClass("hidden"),Q("#wpoptimize_table_list tbody").css("opacity","0.5"),M("get_table_list",{refresh_plugin_json:!0},z).always(function(){e.addClass("hidden")})}),Q("#wpo-404-detector-form").on("click","#wpo-404-clear-logs",function(t){t.preventDefault(),J(wpoptimize.please_wait),M("truncate_404_logs",{},function(t){t&&t.hasOwnProperty("success")&&t.success&&Q("#wpo_404_detector_results").html(""),t&&t.hasOwnProperty("message")&&t.message&&J(t.message,{},3e3)}).fail(function(){J(wpoptimize.something_wrong_try_again,{},3e3)})}),Q("#database_settings_form, #settings_form, #wpo-404-detector-form").on("click",".wpo-save-settings",function(t){t.preventDefault();var i=Q(this).closest("form"),o=i.find(".wpo-saving-settings"),n=a();i.trigger("wpo-saving-form-data"),i.form_errors.has_errors()||(o.show(),J(wpoptimize.saving),Q("#optimizations_list").length&&Q("#optimizations_list .optimization_checkbox:checked").each(function(){var t=Q(this).closest(".wp-optimize-settings").data("optimization_id");t&&(n+="&optimization-options["+t+"][active]=1")}),Q("#purge_cache_permissions").length&&(Q("#purge_cache_permissions").val()||(n+="&purge_cache_permissions[]")),M("save_settings",n,function(t){if(o.closest("div").find(".save-done").show().delay(5e3).fadeOut(),t&&t.hasOwnProperty("save_results")&&t.save_results&&t.save_results.hasOwnProperty("errors"))for(var i=0,n=t.save_results.errors.length;i<n;i++){var a='<div class="error">'+t.errors[i]+"</div>";e(a,"#wp-optimize-settings-save-results")}t&&t.hasOwnProperty("status_box_contents")&&Q(t.status_box_contents).each(function(t,e){Q(e).is("#wp_optimize_status_box")&&Q("#wp_optimize_status_box").replaceWith(Q(e))}),t&&t.hasOwnProperty("optimizations_table")&&Q("#optimizations_list").replaceWith(t.optimizations_table),t&&t.hasOwnProperty("settings_auto_cleanup_contents")&&Q("#wpo_auto_cleanup").replaceWith(t.settings_auto_cleanup_contents),t&&t.hasOwnProperty("logging_settings_contents")&&Q("#wpo_logging_settings").replaceWith(t.logging_settings_contents);var s=Q("#wpo_404_detector");s.prop("checked",!s.prop("checked"));var r=Q("#wpo_404_detector_results");r.css("display",s.prop("checked")?"block":"none"),t.save_results.refresh&&location.reload()}).always(function(){o.hide(),Q.unblockUI()}))}),Q("#database_settings_form").on("click",".wpo_save_event",function(){setTimeout(function(){Q("#wp-optimize-save-database-settings").trigger("click")},500)}),Q("#settings_form").on("click",".wpo_save_logging",function(){setTimeout(function(){Q("#wp-optimize-save-main-settings").trigger("click")},500)}),Q("#settings_form").on("click",".wpo-wipe-settings",function(){var t=Q(this).parent().find(".wpo_spinner");t.show(),M("wipe_settings",{},function(){t.next().removeClass("display-none").delay(5e3).fadeOut(),alert(wpoptimize.settings_have_been_deleted_successfully),location.replace(wpoptimize.settings_page_url)}).always(function(){t.hide()})}),Q("#wp-optimize-wrap").on("click","#wp_optimize_status_box_refresh",function(t){t.preventDefault(),Q("#wp_optimize_status_box").css("opacity","0.5"),M("get_status_box_contents",null,function(t){Q("#wp_optimize_status_box").css("opacity","1"),Q(t).each(function(t,e){Q(e).is("#wp_optimize_status_box")&&Q("#wp_optimize_status_box").replaceWith(Q(e))})})});var dt={};Q("#wpo_import_settings_btn").on("click",function(t){var e=Q("#wpo_import_settings_file"),i=e.val(),o=e[0].files[0],n=new FileReader;return Q("#wpo_import_settings_btn").prop("disabled",!0),/\.json$/.test(i)?(n.onload=function(){j(this.result)},n.readAsText(o),!1):(t.preventDefault(),Q("#wpo_import_settings_btn").prop("disabled",!1),Q("#wpo_import_error_message").text(wpoptimize.please_select_settings_file).slideDown(),!1)}),Q("#wpo_import_settings_file").on("change",function(){Q("#wpo_import_error_message").slideUp()}),Q("#wpo_export_settings_btn").on("click",function(t){return P(a("object")),!1});var mt=function(t,e,i){return M("get_optimization_info",{optimization_id:e,data:i},function(i){var o=i&&i.result&&i.result.meta?i.result.meta:{},n=i&&i.result&&i.result.output?i.result.output.join("<br>"):"...";Q(document).trigger(["optimization_get_info_",e].join(""),[n,o]),t.html(n),o.finished?Q(document).trigger(["optimization_get_info_",e,"_done"].join(""),i):setTimeout(function(){var i=mt(t,e,o);Q(document).trigger(["optimization_get_info_xhr_",e].join(""),[i,o])},1)})};Q("#wpoptimize_table_list").on("click",".run-single-table-optimization",function(){var t=Q("#enable-auto-backup-1"),e=Q(this);t.is(":checked")?g(function(){y(e)}):y(e)}),Q("#wpoptimize_table_list").on("click",".run-single-table-repair",function(){var t=Q(this),e=t.next(),i=e.next(),o=t.data("table"),n={optimization_id:"repairtables",optimization_table:o};e.removeClass("visibility-hidden"),M("do_optimization",{optimization_id:"repairtables",data:n},function(n){if(n.result.meta.success){var a=t.closest("tr"),s=n.result.meta.tableinfo;t.prop("disabled",!1),e.addClass("visibility-hidden"),i.show().removeClass("visibility-hidden"),k(a,s),setTimeout(function(){var e=t.closest("td"),i=t.closest(".wpo_button_wrap");i.fadeOut("fast",function(){i.closest(".wpo_button_wrap").remove(),s.is_type_supported&&Q(".wpo_button_wrap",e).removeClass("wpo_hidden")}),W()},1e3)}else t.prop("disabled",!1),e.addClass("visibility-hidden"),alert(wpoptimize.table_was_not_repaired.replace("%s",o))})}),Q("#wpoptimize_table_list").on("click",".toinnodb",function(){T(Q(this))});var ut;return Q("#wpoptimize_table_list").on("click",".run-single-table-delete",function(){ut=Q(this);var t=Q("#enable-auto-backup-1");""==wpoptimize.user_always_ignores_table_deletion_warning||"1"!==wpoptimize.user_always_ignores_table_deletion_warning?wp_optimize.modal.open({className:"wpo-confirm",events:{"click .wpo-modal--bg":"close","click .delete-table":"deleteTable","change #confirm_deletion_without_backup":"changeConfirm","change #confirm_table_deletion":"changeConfirm"},content:function(){var e=wp.template("wpo-table-delete"),i=ut.closest("tr").find(".table-plugins").html();return e({no_backup:!t.is(":checked"),plugins_list:i,table_name:ut.data("table")})},changeConfirm:function(){var t=!0,e=this.$("#confirm_deletion_without_backup"),i=this.$("#confirm_table_deletion");e.length&&!e.is(":checked")&&(t=!1),
i.is(":checked")||(t=!1),this.$(".delete-table").prop("disabled",!t)},deleteTable:function(){var e=this.$("#ignores_table_deletion_warning");e.is(":checked")&&M("user_ignores_table_deletion_warning",{},function(t){t.success&&(wpoptimize.user_always_ignores_table_deletion_warning="1")}),t.is(":checked")?g(D):D(),this.close()}}):t.is(":checked")?g(D):D()}),W(),Q("#wp-optimize-general-settings").on("wpo-saving-form-data",function(){var t=!0,e=Q(this);Q(".wpo_logger_addition_option, .wpo_logger_type").each(function(){q(Q(this),!0)?Q(this).removeClass("wpo_error_field"):(t=!1,Q(this).addClass("wpo_error_field"))}),t?(e.form_errors.remove("missing-fields"),Q("#wp-optimize-logger-settings .save_settings_reminder").slideUp()):(e.form_errors.add("missing-fields",""),Q("#wp-optimize-settings-save-results").show().addClass("wpo_alert_notice").text(wpoptimize.fill_all_settings_fields).delay(5e3).fadeOut(3e3,function(){Q(this).removeClass("wpo_alert_notice")}))}),setTimeout(function(){M("check_overdue_crons",null,function(t){t&&t.hasOwnProperty("m")&&Q("#wpo_settings_warnings").append(t.m)})},11e3),Q(".wpo-introduction-notice .notice-dismiss, .wpo-introduction-notice .close").on("click",function(t){Q(".wpo-introduction-notice").remove(),M("dismiss_install_or_update_notice",null,function(t){t&&t.hasOwnProperty("error")&&console.log("There was an error dismissing the install or update notice (dismiss_install_or_update_notice)",t)})}),Q("#wpo-settings-export").on("click",A),Q("#wpo-settings-import").on("click",function(t){t.preventDefault(),J(wpoptimize.importing);var e=document.getElementById("import_settings");return 0===e.files.length?(alert(wpoptimize.import_select_file),void Q.unblockUI()):void S(e.files[0])}),K.setup(),{send_command:M,optimization_get_info:mt,take_a_backup_with_updraftplus:g,save_auto_backup_options:f,build_settings:I}};jQuery(function(t){function e(e){var i=["#",e.data("additional")].join("");e.is(":checked")?t(i).show():t(i).hide()}function i(){var e=t("#wp-optimize-logger-settings .save_settings_reminder");e.is(":visible")||e.slideDown("normal")}function o(){t(".wpo_logger_type").each(function(){n(t(this))})}function n(e){var i,o,n=a();for(i in n)o=n[i],wpoptimize.loggers_classes_info[o].allow_multiple?t('option[value="'+o+'"]',e).show():t('option[value="'+o+'"]',e).hide()}function a(){var e=[];return t(".wpo_logging_row, .wpo_logger_type").each(function(){var i=t(this).is("select")?t(this).val():t(this).data("id");i&&e.push(i)}),e}function s(){var t,e=['<option value="">'+wpoptimize.select_destination+"</option>"];for(t in wpoptimize.loggers_classes_info)wpoptimize.loggers_classes_info.hasOwnProperty(t)&&wpoptimize.loggers_classes_info[t].available&&e.push(['<option value="',t,'">',wpoptimize.loggers_classes_info[t].description,"</option>"].join(""));return['<div class="wpo_add_logger_form">','<select class="wpo_logger_type" name="wpo-logger-type[]">',e.join(""),"</select>",'<div class="wpo_logging_edit_row" style="display:block;"><span class="wpo_delete_logger button button-secondary" title="'+wpoptimize.cancel+'">'+wpoptimize.cancel+"</span>",'<span class="wpo_save_logging button button-primary" title="'+wpoptimize.add+'">'+wpoptimize.add+"</span></div>",'<div class="wpo_additional_logger_options"></div>',"</div>"].join("")}function r(t){if(!wpoptimize.loggers_classes_info[t].options)return"";var e,i=wpoptimize.loggers_classes_info[t].options,o=[],n="",a="";for(e in i)i.hasOwnProperty(e)&&(Array.isArray(i[e])?(n=i[e][0].trim(),a=i[e][1].trim()):(n=i[e].trim(),a=""),o.push(['<input class="wpo_logger_addition_option" type="text" name="wpo-logger-options[',e,'][]" value="" ','placeholder="',n,'" ',""!==a?'data-validate="'+a+'"':"","/>"].join("")));return o.push('<input type="hidden" name="wpo-logger-options[active][]" value="1" />'),o.join("")}t(".wp-optimize-logging-settings").each(function(){var i=t(this);e(i),i.on("change",function(){e(i)})});var p=t("#settings_form");p.on("click","#wpo_add_logger_link",function(e){e.preventDefault(),t("#wp-optimize-logger-settings .save_settings_reminder").after(s()),n(t(".wpo_logger_type").first())}),t("#wp-optimize-general-settings").on("change",".wpo_logger_type",function(){var e=t(this),o=e.val(),n=e.parent().find(".wpo_additional_logger_options");n.html(r(o)),e.val()&&i()}),t("#settings_form").on("click",".wpo_logging_actions_row .wpo_edit_logger",function(){var e=t(this),i=e.closest(".wpo_logging_row");return t(".wpo_additional_logger_options",i).removeClass("wpo_hidden"),t(".wpo_logging_options_row",i).hide(),t(".wpo_logging_status_row",i).hide(),e.parent(".wpo_logging_actions_row").hide(),t(i).children(".wpo_logging_edit_row").show(),!1}),t("#settings_form").on("click",".wpo_logging_edit_row .wpo_cancel_logging",function(){var e=t(this),i=e.closest(".wpo_logging_row");return t(i).children(".wpo_logging_edit_row").hide(),t(i).children(".wpo_logging_options_row").show(),t(i).children(".wpo_logging_status_row").show(),t(i).children(".wpo_logging_actions_row").show(),t(i).children(".wpo_additional_logger_options").addClass("wpo_hidden"),!1}),t("#wp-optimize-logger-settings").on("change",".wpo_logger_addition_option",function(){i()}),t("#settings_form").on("change",".wpo_logger_active_checkbox",function(){var e=t(this),i=e.closest("label").find('input[type="hidden"]');i.val(e.is(":checked")?"1":"0")}),t("#wp-optimize-general-settings").on("click",".wpo_delete_logger",function(){if(!confirm(wpoptimize.are_you_sure_you_want_to_remove_logging_destination))return!1;var e=t(this);return e.closest(".wpo_logging_row, .wpo_add_logger_form").remove(),o(),0==t("#wp-optimize-logging-options .wpo_logging_row").length&&t("#wp-optimize-logging-options").hide(),setTimeout(function(){t("#wp-optimize-save-main-settings").trigger("click")},500),!1});var l=!1;t(window).on("scroll",function(e){window.requestAnimationFrame(function(){var e=t(".wpo-main-header").length?t(".wpo-main-header")[0].offsetTop:0;window.pageYOffset>e-20!=l&&(l=!l,t("body").toggleClass("is-scrolled",l))})}),t(".wpo-info__trigger").on("click",function(e){e.preventDefault();var i=t(this).closest(".wpo-info");i.toggleClass("opened")}),t(".wpo-video-preview a").on("click",function(e){var i=t(this).data("embed");if(i){e.preventDefault();var o=t('<iframe width="356" height="200" allowfullscreen webkitallowfullscreen mozallowfullscreen>').attr("src",i);o.insertAfter(t(this)),t(this).remove(),o.focus()}})});